#/bin/bash

repo start occam bionic frameworks/base system/sepolicy vendor/google/build

TOOLS_DIRNAME=$(dirname $0)
PATCHES_DIRNAME=${TOOLS_DIRNAME}/../patches/
TOP=${ANDROID_BUILD_TOP}
for D in ${PATCHES_DIRNAME}/*
do
  PD=$(basename $D)
  APPLY_DIR=${PD//_/\/}
  echo $PD $APPLY_DIR
  echo "apply patches to" ${APPLY_DIR}
  for PATCH in ${D}/*
  do
    echo "apply" ${PATCH}
    ( cd ${APPLY_DIR} && git am ${PATCH} )
  done
done

# Hack to force a prior version of googleCamera. Versions 3 and up do not work on mako with AOSP 7.1.2
# Need to update the API level (currently 25) when a new version of Android becomes available
cp $TOP/vendor/bijia/googleaddons/apk/googlecamera/arm/app/com.google.android.googlecamera/19/nodpi/27010130.apk $TOP/vendor/opengapps/sources/arm/app/com.google.android.googlecamera/25/nodpi/*.apk

# Copy last known working version for mako of HotWordEnrollment apk which is no longer part of the opengapps repo
cp $TOP/vendor/bijia/googleaddons/apk/HotwordEnrollment/all/priv-app/com.android.hotwordenrollment/24/nodpi/24.apk $TOP/vendor/opengapps/sources/all/priv-app/com.android.hotwordenrollment/24/nodpi/24.apk
